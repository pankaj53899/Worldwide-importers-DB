--customers table
SELECT [CustomerID]
      ,[CustomerName]
      ,[AccountOpenedDate]
      ,[PostalAddressLine2]
into [WideWorldImporters].[Dbo].[Customers]
FROM [WideWorldImporters].[Sales].[Customers];

--orders table
SELECT [OrderID]
      ,[CustomerID]
      ,[OrderDate]
      ,[ExpectedDeliveryDate]
      ,[CustomerPurchaseOrderNumber]
	  into [WideWorldImporters].[Dbo].[Orders]
  FROM [WideWorldImporters].[Sales].[Orders];

  --orderlines table
  SELECT [OrderLineID]
      ,[OrderID]
      ,[StockItemID]
      ,[Description]
      ,[Quantity]
      ,[UnitPrice]
      ,[TaxRate]
      ,[PickedQuantity]
  into [WideWorldImporters].[Dbo].[OrderLines]
  FROM [WideWorldImporters].[Sales].[OrderLines];

  --stockitems table
drop table if exists [WideWorldImporters].[dbo].[StockItems];
with stockItemsGroup as
(select	a.[StockItemID], a.[StockItemName], a.[TaxRate], a.[UnitPrice], a.[RecommendedRetailPrice], c.[StockGroupName]
from [WideWorldImporters].[Warehouse].[StockItems] a
left join [WideWorldImporters].[Warehouse].[StockItemStockGroups] b on a.StockItemID=b.StockItemID
left join [WideWorldImporters].[Warehouse].[StockGroups] c on b.StockGroupID=c.StockGroupID)
select [StockItemID], [StockItemName], [TaxRate], [UnitPrice], [RecommendedRetailPrice], 
	  STRING_AGG(CONVERT(NVARCHAR(max), [StockGroupName]), ' | ') WITHIN GROUP (ORDER BY [StockGroupName] ASC) AS StockGroupNames   
      into [WideWorldImporters].[dbo].[StockItems]
	  FROM stockItemsGroup
      GROUP BY [StockItemID] ,[StockItemName] ,[TaxRate] ,[UnitPrice] ,[RecommendedRetailPrice];

--invoices table
SELECT [InvoiceID]
      ,[CustomerID]
      ,[OrderID]
      ,[InvoiceDate]
      ,[CustomerPurchaseOrderNumber]
	  into [WideWorldImporters].[Dbo].[Invoices]
  FROM [WideWorldImporters].[Sales].[Invoices];

  --invoicelines table
  SELECT TOP (1000) [InvoiceLineID]
      ,[InvoiceID]
      ,[StockItemID]
      ,[Description]
      ,[Quantity]
      ,[UnitPrice]
      ,[TaxRate]
      ,[TaxAmount]
      ,[LineProfit] 
      ,[ExtendedPrice]
	  into [WideWorldImporters].[Dbo].[InvoiceLines]
  FROM [WideWorldImporters].[Sales].[InvoiceLines];


/*Columns present in the tables

[WideWorldImporters].[dbo].[Customers]
	[CustomerID]
	[CustomerName]
	[AccountOpenedDate] - account opening date
	[PostalAddressLine2] - city

[WideWorldImporters].[dbo].[Orders]       
	[OrderID]
	[CustomerID]
        [OrderDate]- order date
        [ExpectedDeliveryDate] - expected delivery date
        [CustomerPurchaseOrderNumber] - customer purchase order number

[WideWorldImporters].[dbo].[OrderLines]
	[OrderLineID]
        [OrderID]
        [StockItemID] - item id
        [Description] - item name
        [Quantity] - item quantity
        [UnitPrice] - unit price of the item
        [TaxRate] - tax rate on the item
        [PickedQuantity] - picked quantity

[WideWorldImporters].[dbo].[Invoices]
	[InvoiceID]
	[CustomerID]
	[OrderID]
	[InvoiceDate]
	[CustomerPurchaseOrderNumber]

[WideWorldImporters].[dbo].[InvoiceLines]
	[InvoiceLineID]
	[InvoiceID]
	[StockItemID]
	[Description] - name of the item
	[Quantity]
	[UnitPrice]
	[TaxRate]
	[TaxAmount]
	[LineProfit] - profit margin
	[ExtendedPrice] - gross price


[WideWorldImporters].[dbo].[StockItems]
	[StockItemID]
        [StockItemName]
        [TaxRate]
        [UnitPrice]
        [RecommendedRetailPrice]
	[StockGroupName]- item group

*/
